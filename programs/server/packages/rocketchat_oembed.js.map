{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_oembed/server/server.coffee","meteor://ðŸ’»app/packages/rocketchat_oembed/server/providers.coffee","meteor://ðŸ’»app/packages/rocketchat:oembed/server/jumpToMessage.js","meteor://ðŸ’»app/packages/rocketchat_oembed/server/models/OEmbedCache.coffee"],"names":["URL","Npm","require","QueryString","RocketChat","callbacks","add","msg","urls","forEach","item","url","indexOf","Meteor","absoluteUrl","urlObj","parse","query","queryString","_","isString","jumpToMessage","models","Messages","findOneById","attachments","push","u","username","getAvatarUrlFromUsername","ts","ignoreParse","priority","LOW"],"mappings":"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","file":"/packages/rocketchat_oembed.js","sourcesContent":[null,null,"/* globals getAvatarUrlFromUsername */\n\nconst URL = Npm.require('url');\nconst QueryString = Npm.require('querystring');\n\nRocketChat.callbacks.add('beforeSaveMessage', (msg) => {\n\tif (msg && msg.urls) {\n\t\tmsg.urls.forEach((item) => {\n\t\t\tif (item.url.indexOf(Meteor.absoluteUrl()) === 0) {\n\t\t\t\tconst urlObj = URL.parse(item.url);\n\t\t\t\tif (urlObj.query) {\n\t\t\t\t\tconst queryString = QueryString.parse(urlObj.query);\n\t\t\t\t\tif (_.isString(queryString.msg)) { // Jump-to query param\n\t\t\t\t\t\tlet jumpToMessage = RocketChat.models.Messages.findOneById(queryString.msg);\n\t\t\t\t\t\tif (jumpToMessage) {\n\t\t\t\t\t\t\tmsg.attachments = msg.attachments || [];\n\t\t\t\t\t\t\tmsg.attachments.push({\n\t\t\t\t\t\t\t\t'text' : jumpToMessage.msg,\n\t\t\t\t\t\t\t\t'author_name' : jumpToMessage.u.username,\n\t\t\t\t\t\t\t\t'author_icon' : getAvatarUrlFromUsername(jumpToMessage.u.username),\n\t\t\t\t\t\t\t\t'message_link' : item.url,\n\t\t\t\t\t\t\t\t'attachments' : jumpToMessage.attachments || [],\n\t\t\t\t\t\t\t\t'ts': jumpToMessage.ts\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\titem.ignoreParse = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\treturn msg;\n}, RocketChat.callbacks.priority.LOW, 'jumpToMessage');\n",null]}