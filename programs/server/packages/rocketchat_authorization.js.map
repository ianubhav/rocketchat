{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat_authorization/lib/rocketchat.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/models/Permissions.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/models/Roles.coffee","meteor://ðŸ’»app/packages/rocketchat:authorization/server/models/Base.js","meteor://ðŸ’»app/packages/rocketchat:authorization/server/models/Users.js","meteor://ðŸ’»app/packages/rocketchat:authorization/server/models/Subscriptions.js","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/addUserRoles.coffee","meteor://ðŸ’»app/packages/rocketchat:authorization/server/functions/canAccessRoom.js","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/getRoles.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/getUsersInRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/hasPermission.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/hasRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/functions/removeUserFromRoles.coffee","meteor://ðŸ’»app/packages/rocketchat:authorization/server/publications/permissions.js","meteor://ðŸ’»app/packages/rocketchat_authorization/server/publications/roles.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/publications/usersInRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/addUserToRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/deleteRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/removeUserFromRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/saveRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/addPermissionToRole.coffee","meteor://ðŸ’»app/packages/rocketchat_authorization/server/methods/removeRoleFromPermission.coffee"],"names":["RocketChat","models","_Base","prototype","roleBaseQuery","findRolesByUserId","userId","query","find","fields","roles","isUserInRole","roleName","scope","_","isUndefined","findOne","addRolesByUserId","concat","update","$addToSet","$each","removeRolesByUserId","$pullAll","findUsersInRoles","Meteor","Error","Users","_id","options","$in","Subscriptions","rid","subscriptions","fetch","users","compact","map","subscription","u","authz","roomAccessValidators","room","user","usernames","indexOf","username","t","hasPermission","canAccessRoom","some","validator","call","addRoomAccessValidator","push","methods","updatedAt","unblock","Date","Permissions","dinamicFindChangesAfter","on","type","records","getChangedRecords","record","Notifications","notifyAll"],"mappings":"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","file":"/packages/rocketchat_authorization.js","sourcesContent":[null,null,null,"RocketChat.models._Base.prototype.roleBaseQuery = function(/*userId, scope*/) {\n\treturn;\n};\n\nRocketChat.models._Base.prototype.findRolesByUserId = function(userId/*, options*/) {\n\tvar query = this.roleBaseQuery(userId);\n\treturn this.find(query, { fields: { roles: 1 } });\n};\n\nRocketChat.models._Base.prototype.isUserInRole = function(userId, roleName, scope) {\n\tvar query = this.roleBaseQuery(userId, scope);\n\n\tif (query == null) {\n\t\treturn false;\n\t}\n\n\tquery.roles = roleName;\n\treturn !_.isUndefined(this.findOne(query));\n};\n\nRocketChat.models._Base.prototype.addRolesByUserId = function(userId, roles, scope) {\n\troles = [].concat(roles);\n\tvar query = this.roleBaseQuery(userId, scope);\n\tvar update = {\n\t\t$addToSet: {\n\t\t\troles: { $each: roles }\n\t\t}\n\t};\n\treturn this.update(query, update);\n};\n\nRocketChat.models._Base.prototype.removeRolesByUserId = function(userId, roles, scope) {\n\troles = [].concat(roles);\n\tvar query = this.roleBaseQuery(userId, scope);\n\tvar update = {\n\t\t$pullAll: {\n\t\t\troles: roles\n\t\t}\n\t};\n\treturn this.update(query, update);\n};\n\nRocketChat.models._Base.prototype.findUsersInRoles = function() {\n\tthrow new Meteor.Error('overwrite-function', 'You must overwrite this function in the extended classes');\n};\n","RocketChat.models.Users.roleBaseQuery = function(userId) {\n\treturn { _id: userId };\n};\n\nRocketChat.models.Users.findUsersInRoles = function(roles, scope, options) {\n\troles = [].concat(roles);\n\n\tvar query = {\n\t\troles: { $in: roles }\n\t};\n\n\treturn this.find(query, options);\n};\n","RocketChat.models.Subscriptions.roleBaseQuery = function(userId, scope) {\n\tif (scope == null) {\n\t\treturn;\n\t}\n\n\tvar query = { 'u._id': userId };\n\tif (!_.isUndefined(scope)) {\n\t\tquery.rid = scope;\n\t}\n\treturn query;\n};\n\nRocketChat.models.Subscriptions.findUsersInRoles = function(roles, scope, options) {\n\troles = [].concat(roles);\n\n\tvar query = {\n\t\troles: { $in: roles }\n\t};\n\n\tif (scope) {\n\t\tquery.rid = scope;\n\t}\n\n\tvar subscriptions = this.find(query).fetch();\n\n\tvar users = _.compact(_.map(subscriptions, function(subscription) {\n\t\tif ('undefined' !== typeof subscription.u && 'undefined' !== typeof subscription.u._id) {\n\t\t\treturn subscription.u._id;\n\t\t}\n\t}));\n\n\treturn RocketChat.models.Users.find({ _id: { $in: users } }, options);\n};\n",null,"/* globals RocketChat */\nRocketChat.authz.roomAccessValidators = [\n\tfunction(room, user) {\n\t\treturn room.usernames.indexOf(user.username) !== -1;\n\t},\n\tfunction(room, user) {\n\t\tif (room.t === 'c') {\n\t\t\treturn RocketChat.authz.hasPermission(user._id, 'view-c-room');\n\t\t}\n\t}\n];\n\nRocketChat.authz.canAccessRoom = function(room, user) {\n\treturn RocketChat.authz.roomAccessValidators.some((validator) => {\n\t\treturn validator.call(this, room, user);\n\t});\n};\n\nRocketChat.authz.addRoomAccessValidator = function(validator) {\n\tRocketChat.authz.roomAccessValidators.push(validator);\n};\n",null,null,null,null,null,"Meteor.methods({\n\t'permissions/get'(updatedAt) {\n\t\tthis.unblock();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn RocketChat.models.Permissions.dinamicFindChangesAfter('find', updatedAt);\n\t\t}\n\n\t\treturn RocketChat.models.Permissions.find().fetch();\n\t}\n});\n\n\nRocketChat.models.Permissions.on('change', (type, ...args) => {\n\tconst records = RocketChat.models.Permissions.getChangedRecords(type, args[0]);\n\n\tfor (const record of records) {\n\t\tRocketChat.Notifications.notifyAll('permissions-changed', type, record);\n\t}\n});\n",null,null,null,null,null,null,null,null]}