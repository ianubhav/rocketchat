{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:action-links/loadStylesheets.js","meteor://ðŸ’»app/packages/rocketchat:action-links/server/registerActionLinkFuncts.js","meteor://ðŸ’»app/packages/rocketchat:action-links/server/actionLinkHandler.js"],"names":["RocketChat","theme","addPackageAsset","Assets","getText","actionLinks","register","name","funct","Meteor","methods","actionLinkHandler","messageId","userId","Error","method","message","models","Messages","findOne","_id","actionLink","method_id","room","Rooms","rid","Array","isArray","usernames","indexOf","user","username","params"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,WAAWC,KAAX,CAAiBC,eAAjB,CAAiC,YAAW;AAC3C,QAAOC,OAAOC,OAAP,CAAe,qCAAf,CAAP;AACA,CAFD,mH;;;;;;;;;;;ACAA;;AAEAJ,WAAWK,WAAX,GAAyB;AACxBC;AAAW,oBAASC,IAAT,EAAeC,KAAf,EAAsB;AAChCR,cAAWK,WAAX,CAAuBE,IAAvB,IAA+BC,KAA/B;AACA;;AAFD;AAAA;AADwB,CAAzB,mH;;;;;;;;;;;ACFA;;AAEAC,OAAOC,OAAP,CAAe;AACdC,kBADc;AAAA,6BACIJ,IADJ,EACUK,SADV,EACqB;AAClC,OAAI,CAACH,OAAOI,MAAP,EAAL,EAAsB;AACrB,UAAM,IAAIJ,OAAOK,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD,EAAEC,QAAQ,mBAAV,EAAvD,CAAN;AACA;;AAED,OAAIC,UAAUhB,WAAWiB,MAAX,CAAkBC,QAAlB,CAA2BC,OAA3B,CAAmC,EAAEC,KAAKR,SAAP,EAAnC,CAAd;AACA,OAAI,CAACI,OAAL,EAAc;AACb,UAAM,IAAIP,OAAOK,KAAX,CAAiB,uBAAjB,EAA0C,iBAA1C,EAA6D,EAAEC,QAAQ,mBAAV,EAA7D,CAAN;AACA;;AAED,OAAIM,aAAaL,QAAQX,WAAR,CAAoBE,IAApB,CAAjB;AACA,OAAI,CAACS,QAAQX,WAAT,IAAwB,CAACgB,UAAzB,IAAuC,CAACrB,WAAWK,WAAnD,IAAkE,CAACL,WAAWK,WAAX,CAAuBgB,WAAWC,SAAlC,CAAvE,EAAqH;AACpH,UAAM,IAAIb,OAAOK,KAAX,CAAiB,0BAAjB,EAA6C,qBAA7C,EAAoE,EAAEC,QAAQ,mBAAV,EAApE,CAAN;AACA;;AAED,OAAIQ,OAAOvB,WAAWiB,MAAX,CAAkBO,KAAlB,CAAwBL,OAAxB,CAAgC,EAAEC,KAAKJ,QAAQS,GAAf,EAAhC,CAAX;AACA,OAAIC,MAAMC,OAAN,CAAcJ,KAAKK,SAAnB,KAAiCL,KAAKK,SAAL,CAAeC,OAAf,CAAuBpB,OAAOqB,IAAP,GAAcC,QAArC,MAAmD,CAAC,CAAzF,EAA4F;AAC3F,UAAM,IAAItB,OAAOK,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD,EAAEC,QAAQ,mBAAV,EAArD,CAAN;AACA;;AAEDf,cAAWK,WAAX,CAAuBgB,WAAWC,SAAlC,EAA6CN,OAA7C,EAAsDK,WAAWW,MAAjE;AACA;;AAtBa;AAAA;AAAA,CAAf,mH","file":"/packages/rocketchat_action-links.js","sourcesContent":["RocketChat.theme.addPackageAsset(function() {\n\treturn Assets.getText('client/stylesheets/actionLinks.less');\n});\n","//Action Links namespace creation.\n\nRocketChat.actionLinks = {\n\tregister : function(name, funct) {\n\t\tRocketChat.actionLinks[name] = funct;\n\t}\n};\n","//Action Links Handler. This method will be called off the client.\n\nMeteor.methods({\n\tactionLinkHandler(name, messageId) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'actionLinkHandler' });\n\t\t}\n\n\t\tvar message = RocketChat.models.Messages.findOne({ _id: messageId });\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'Invalid message', { method: 'actionLinkHandler' });\n\t\t}\n\n\t\tvar actionLink = message.actionLinks[name];\n\t\tif (!message.actionLinks || !actionLink || !RocketChat.actionLinks || !RocketChat.actionLinks[actionLink.method_id]) {\n\t\t\tthrow new Meteor.Error('error-invalid-actionlink', 'Invalid action link', { method: 'actionLinkHandler' });\n\t\t}\n\n\t\tvar room = RocketChat.models.Rooms.findOne({ _id: message.rid });\n\t\tif (Array.isArray(room.usernames) && room.usernames.indexOf(Meteor.user().username) === -1) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'actionLinkHandler' });\n\t\t}\n\n\t\tRocketChat.actionLinks[actionLink.method_id](message, actionLink.params);\n\t}\n});\n"]}